{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Register (3/3): Account - KabsuEats</title>
    <link rel="stylesheet" href="{% static 'css/business_owner_registration.css' %}">
</head>
<body>
    <div class="registration-container">
        <div class="registration-header">
            <h1>Business Registration</h1>
            <div class="progress-bar">
                <div class="progress-step active">1</div>
                <div class="progress-step active">2</div>
                <div class="progress-step active">3</div>
            </div>
        </div>

        <div class="registration-content">
            <h2>Step 3: Create Your Account</h2>
            <p>Set up your login credentials. Your password must be at least 8 characters long. An OTP will be sent to your email for verification.</p>

            <form id="credentials-form" onsubmit="return false;">
                {% csrf_token %}
                <div class="form-grid">
                     <div class="form-group full-width">
                        <label for="email">Gmail Address</label>
                        <input type="email" id="email" name="email" required>
                    </div>
                     <div class="form-group password-field">
                        <label for="password">Password</label>
                        <div class="password-wrapper">
                            <input type="password" id="password" name="password" required minlength="8">
                            <button type="button" class="toggle-password" data-target="password">
                                <svg class="eye-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                                <svg class="eye-slash-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
                                    <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                                    <line x1="1" y1="1" x2="23" y2="23"></line>
                                </svg>
                            </button>
                        </div>
                    </div>
                     <div class="form-group password-field">
                        <label for="retype-password">Retype Password</label>
                        <div class="password-wrapper">
                            <input type="password" id="retype-password" name="retype_password" required minlength="8">
                            <button type="button" class="toggle-password" data-target="retype-password">
                                <svg class="eye-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                                <svg class="eye-slash-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
                                    <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                                    <line x1="1" y1="1" x2="23" y2="23"></line>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </form>

            <div class="navigation-buttons">
                <button id="back-step-btn" class="btn-secondary">Back: Details</button>
                <button id="send-otp-btn" class="btn-primary" disabled>Send OTP to register establishment</button>
            </div>
            <p class="login-link">Already have an account? <a href="{% url 'owner_login' %}">Login here</a>.</p>
        </div>
    </div>

    <!-- OTP Modal -->
    <div id="otpModal" class="modal">
        <div class="modal-content">
            <h3>Enter OTP</h3>
            <p>Please enter the 6-digit code sent to <strong id="otp-email-display"></strong></p>

            <!-- OTP Timer Display -->
            <div id="otp-timer-container" style="margin: 15px 0; padding: 10px; background: #f0f9ff; border-radius: 8px; text-align: center;">
                <p style="margin: 0; color: #0369a1; font-size: 14px;">
                    <span id="otp-timer-label">OTP expires in:</span>
                    <strong id="otp-timer" style="font-size: 16px; color: #dc2626;">10:00</strong>
                </p>
            </div>

            <form id="otpForm">
                <input type="text" id="otp-input" maxlength="6" pattern="\d{6}" required placeholder=" " autocomplete="one-time-code">
                <div id="loadingSpinner" class="spinner" style="display: none;"></div>
                <p id="otpError" style="color: red; min-height: 1.2em;"></p>

                <button type="submit" class="btn-primary" id="verify-otp-btn">Verify and Register</button>

                <!-- Resend OTP Button -->
                <button type="button" id="resend-otp-btn" class="btn-secondary" style="margin-top: 10px; width: 100%;" disabled>
                    Resend OTP <span id="resend-countdown"></span>
                </button>
            </form>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="modal">
        <div class="modal-content">
            <h3>Registration Successful!</h3>
            <p>Your establishment has been created. Redirecting you to your dashboard...</p>
            <div class="spinner"></div>
        </div>
    </div>

    <script src="{% static 'js/business_owner_registration.js' %}"></script>
    <script>
        // Password visibility toggle functionality
        document.querySelectorAll('.toggle-password').forEach(button => {
            button.addEventListener('click', function() {
                const targetId = this.getAttribute('data-target');
                const passwordInput = document.getElementById(targetId);
                const eyeIcon = this.querySelector('.eye-icon');
                const eyeSlashIcon = this.querySelector('.eye-slash-icon');
                
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    eyeIcon.style.display = 'none';
                    eyeSlashIcon.style.display = 'block';
                } else {
                    passwordInput.type = 'password';
                    eyeIcon.style.display = 'block';
                    eyeSlashIcon.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>